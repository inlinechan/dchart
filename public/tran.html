<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>

         body {
             font: 10px sans-serif;
         }

         .axis path,
         .axis line {
             fill: none;
             stroke: #000;
             shape-rendering: crispEdges;
         }

         /* .x.axis path {
            display: none;
            } */

         .line {
             fill: none;
             stroke: steelblue;
             stroke-width: 1.5px;
         }

        </style>
    </head>
    <body>
        <div class="chart"></div>
        <!-- <div class="chart"></div> -->
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="tran.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
         var socket = io();

         var chart = lineChart()
         .width(640)
         .height(300);

         var svg = null;

         var hasChart = false;
         var pendingData = null;
         socket.on('data', function(line) {
             var data = parser(line);
             if (!hasChart) {
                 if (!pendingData)
                     pendingData = data;
                 else {
                     svg = d3.selectAll(".chart")
                             .data([[pendingData, data]])
                             .call(chart);
                     hasChart = true;
                     pendingData = null;
                 }
             } else {
                 d3.selectAll(".chart")
                   .call(chart.update, data);
             }
         });

         var schema = null;
         var parser = null;
         socket.on('schema', function(data) {
             console.log('schema: ' + data);
             schema = JSON.parse(data);
             parser = getParser(schema.columns);
         });
        </script>
    </body>
</html>
